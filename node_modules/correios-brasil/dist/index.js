"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("axios"),n=require("iconv-lite"),r=require("xml-js");function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o=t(e),a=t(n),c=t(r);function i(e){var n=new RegExp(/[^0-9]|[/ /]/g,""),r=e.trim().replace(n,"");if(8!==r.length)throw Error("Cep: ".concat(e," inválido!"));return r}var u,s=function(){return s=Object.assign||function(e){for(var n,r=1,t=arguments.length;r<t;r++)for(var o in n=arguments[r])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e},s.apply(this,arguments)};function l(e,n,r,t){return new(r||(r=Promise))((function(o,a){function c(e){try{u(t.next(e))}catch(e){a(e)}}function i(e){try{u(t.throw(e))}catch(e){a(e)}}function u(e){var n;e.done?o(e.value):(n=e.value,n instanceof r?n:new r((function(e){e(n)}))).then(c,i)}u((t=t.apply(e,n||[])).next())}))}function p(e,n){var r,t,o,a,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(a){return function(i){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,t&&(o=2&a[0]?t.return:a[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,a[1])).done)return o;switch(t=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return c.label++,{value:a[1],done:!1};case 5:c.label++,t=a[1],a=[0];continue;case 7:a=c.ops.pop(),c.trys.pop();continue;default:if(!(o=c.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){c=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){c.label=a[1];break}if(6===a[0]&&c.label<o[1]){c.label=o[1],o=a;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(a);break}o[2]&&c.ops.pop(),c.trys.pop();continue}a=n.call(e,c)}catch(e){a=[6,e],t=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,i])}}}function f(e,n){return l(this,void 0,void 0,(function(){var r,t;return p(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,o.default(s(s({},n),{url:e}))];case 1:return r=a.sent(),[2,r.data];case 2:return t=a.sent(),[2,new Error(t.response)];case 3:return[2]}}))}))}!function(e){e.BASECEP="https://viacep.com.br/ws",e.BASECORREIOS="http://ws.correios.com.br/calculador/CalcPrecoPrazo.aspx",e.BASERASTREIO="https://www.linkcorreios.com.br",e.WIDENET="https://cep.widenet.host/busca-cep/api/cep",e.PROXYAPP="https://proxyapp.correios.com.br/v1/sro-rastro"}(u||(u={}));var d=u;exports.calcularPrecoPrazo=function(e){var n=e.nCdServico;return Promise.all(n.map((function(n){return function(e,n){var r=this;return delete e.nCdServico,new Promise((function(t,o){return l(r,void 0,void 0,(function(){var r;return p(this,(function(o){return r=s(s({},e),{nCdServico:n,sCepOrigem:i(e.sCepOrigem),sCepDestino:i(e.sCepDestino),nCdEmpresa:null==e.nCdEmpresa?"":e.nCdEmpresa,sDsSenha:null==e.sDsSenha?"":e.sDsSenha,sCdMaoPropria:null==e.sCdMaoPropria?"n":e.sCdMaoPropria,nVlValorDeclarado:null==e.nVlValorDeclarado?0:e.nVlValorDeclarado,sCdAvisoRecebimento:null==e.sCdAvisoRecebimento?"n":e.sCdAvisoRecebimento,StrRetorno:"xml",nIndicaCalculo:null==e.nIndicaCalculo?3:e.nIndicaCalculo}),[2,f("".concat(d.BASECORREIOS,"?").concat(new URLSearchParams(r).toString()),{method:"GET",headers:{"content-type":"application/json"},responseType:"arraybuffer"}).then((function(e){var n,r,o=(n=function(e,n){return a.default.decode(Buffer.from(e),n).toString()}(e,"iso-8859-1"),JSON.parse(c.default.xml2json(n,{compact:!0})));t((r=o.Servicos.cServico,Object.keys(r).reduce((function(e,n){return e[n]=r[n]._text?r[n]._text:r[n]._cdata,e}),{})))}))]}))}))}))}(e,n)}))).then((function(e){return e}))},exports.consultarCep=function(e){return new Promise((function(n,r){return f("".concat(d.BASECEP,"/").concat(i(e),"/json"),{method:"GET",headers:{"content-type":"application/json"}}).then((function(t){return t.erro&&r(Error("Cep: ".concat(e," não existe na nossa base"))),n(t)}))}))},exports.rastrearEncomendas=function(e){return Promise.all(e.map((function(e){return function(e){return new Promise((function(n,r){return f("".concat(d.PROXYAPP,"/").concat(e),{method:"GET",headers:{"content-type":"application/json"}}).then((function(t){return t.erro&&r(Error("Code: ".concat(e," não existe na base dos correios"))),n(t.objetos[0])}))}))}(e)}))).then((function(e){return e}))};
//# sourceMappingURL=index.js.map
